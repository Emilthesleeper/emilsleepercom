<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static',filename='style.css')}}">
    <title>Emil Wege Website</title>
</head>
<body>
    <header>
        <div class="header-container">
            <button class="menu-toggle" id="menuToggle">‚ò∞</button>
            <nav class="nav-left" id="navMenu">
                <ul>
                    <li><a href="/">Projekte</a></li>
                    <li><a href="/about">√úber mich</a></li>
                    <li><a href="/contact">Kontakt</a></li>
                    <li><a href="https://google.com" target="_blank">Auff√ºllen bitte</a></li>
                </ul>
            </nav>
            <div class="nav-right">
                <div class="logo-section">
                    <img src="{{url_for('static',filename='profile.jpg')}}" alt="Logo" class="logo-img">
                    <div class="brand-text">
                        <div class="brand-name">Emil Wege</div>
                        <div class="brand-subtitle">EmilSleeper</div>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="lang-dropdown" id="langDropdown">
                        <button id="langToggle" class="icon-btn" aria-haspopup="true" aria-expanded="false">
                            <img src="{{url_for('static',filename='language.svg')}}" alt="Language" class="icon">
                        </button>
                        <ul class="lang-menu" id="langMenu">
                            <li data-lang="de">Deutsch</li>
                            <li data-lang="en">English</li>
                        </ul>
                    </div>
                    <button id="themeToggle" class="icon-btn" aria-pressed="false" title="Toggle theme">
                        <img src="{{url_for('static',filename='moon.svg')}}" alt="Moon" class="icon" id="modetoggle">
                    </button>
                </div>
            </div>
        </div>
    </header>
    <main>
        <section class="project-gallery">
            {% for project in projects %}
            <div class="project">
                {% if debug %}
                    <a href="{{project['debug_url']}}" target="_blank">
                {% else %}
                    <a href="{{project['url']}}" target="_blank">
                {% endif %}
                <img src="{{url_for('static',filename=project['image'])}}" alt="Image unavailable">
                <h1>{{project['name']}}</h3>
                </a>
                {% set lang = request.args.get('lang', 'de') %}
                <p>{{ project['description'].get(lang, project['description'].get('de', '')) }}</p>
            </div>
            {% endfor %}
        </section>
    </main>
    <footer>
        <p class="footer">&copy; 2024-2025 Emil Wege. All Rights Reserved.</p>
    </footer>
    <script>
        const images = [
            "{{url_for('static',filename='sun.svg')}}",
            "{{url_for('static',filename='moon.svg')}}"
        ];
        function preloadImages() {
            const promises = images.map(src => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.onerror = reject;
                    img.src = src;
                });
            });
            return Promise.all(promises);
        }
        preloadImages();
    </script>
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const navMenu = document.getElementById('navMenu');
        const langToggle = document.getElementById('langToggle');
        const langMenu = document.getElementById('langMenu');
        const langDropdown = document.getElementById('langDropdown');
        const themeToggle = document.getElementById('themeToggle');
        const modetoggle = document.getElementById('modetoggle');

        menuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            navMenu.classList.toggle('active');
        });

        navMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });

        langToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = langToggle.getAttribute('aria-expanded') === 'true';
            langToggle.setAttribute('aria-expanded', String(!expanded));
            langDropdown.classList.toggle('open');
        });

        langMenu.querySelectorAll('li').forEach(item => {
            item.addEventListener('click', () => {
                const lang = item.getAttribute('data-lang');
                const url = new URL(window.location.href);
                url.searchParams.set('lang', lang);
                window.location.href = url.toString();
            });
        });

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            //themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            modetoggle.src = theme === 'dark' ? '{{url_for("static", filename="sun.svg")}}' : '{{url_for("static", filename="moon.svg")}}';
            themeToggle.setAttribute('aria-pressed', String(theme === 'dark'));
        }

        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme') || 'light';
            setTheme(current === 'dark' ? 'light' : 'dark');
        });

        (function(){
            const stored = localStorage.getItem('theme');
            if (stored) {
                setTheme(stored);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        })();

        document.addEventListener('click', (e) => {
            if (!e.target.closest('header')) {
                navMenu.classList.remove('active');
            }
            if (!e.target.closest('#langDropdown')) {
                langDropdown.classList.remove('open');
                langToggle.setAttribute('aria-expanded', 'false');
            }
        });
    </script>
</body>
</html>