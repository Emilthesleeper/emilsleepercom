<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{url_for('static',filename='profile.jpg')}}">
    <link rel="stylesheet" href="{{url_for('static',filename='style.css')}}">
    <title>Emil Wege Website</title>
</head>
<body>
    <header>
        <div class="header-container">
            <button class="menu-toggle" id="menuToggle">☰</button>
            <nav class="nav-left" id="navMenu">
                <ul>
                    <li><a href="/">Projekte</a></li>
                    <li><a href="/about">Über mich</a></li>
                    <li><a href="/contact">Kontakt</a></li>
                    <li><a href="https://example.com" target="_blank">Auffüllen bitte</a></li>
                </ul>
            </nav>
            <div class="nav-right">
                <div class="logo-section">
                    <img src="{{url_for('static',filename='profile.jpg')}}" alt="Logo" class="logo-img">
                    <div class="brand-text">
                        <div class="brand-name">EmilSleeper</div>
                        <div class="brand-subtitle">Emil Wege</div>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="lang-dropdown" id="langDropdown">
                        <button id="langToggle" class="icon-btn" aria-haspopup="true" aria-expanded="false">
                            <img src="{{url_for('static',filename='language.svg')}}" alt="Language" class="icon">
                        </button>
                            <ul class="lang-menu" id="langMenu">
                                <li><a href="?lang=de"><img src="{{url_for('static',filename='germany.png')}}" alt="Deutsch" class="lang-flag">Deutsch</a></li>
                                <li><a href="?lang=en"><img src="{{url_for('static',filename='english.png')}}" alt="English" class="lang-flag">English</a></li>
                            </ul>
                    </div>
                    <button id="themeToggle" class="icon-btn" aria-pressed="false" title="Toggle theme">
                        <img src="{{url_for('static',filename='sun.svg')}}" alt="Moon" class="icon" id="modetoggle">
                    </button>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="filter-bar" role="toolbar" aria-label="Project filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="minecraft">Minecraft</button>
            <button class="filter-btn" data-filter="music">Music (Coming soon)</button>
            <button class="filter-btn" data-filter="games">Games</button>
            <button class="filter-btn" data-filter="apps">Apps</button>
        </div>
        <section class="project-gallery" id="projectGallery">
            {% set lang = request.args.get('lang', 'de') %}
            {% for project in projects %}
            <div class="project {% if project.get('url') == '#' %}under-construction{% endif %}" data-category="{{ project.get('category', 'other') }}">
                {% if project.get('is_folder') %}
                    <a href="#" class="folder-trigger" data-filter="{{ project.get('category','other') }}">
                        <img src="{{url_for('static',filename=project['image'])}}" alt="Image unavailable">
                        <div class="folder-overlay"></div>
                        <h1 class="folder-title">{{ project['name'] }}</h1>
                    </a>
                {% else %}
                    {% if debug and project.get('debug_url') %}
                        <a href="{{project['debug_url']}}" target="_blank">
                    {% else %}
                        <a href="{{project['url']}}" target="_blank">
                    {% endif %}
                        <img src="{{url_for('static',filename=project['image'])}}" alt="Image unavailable">
                        <h1>{{project['name']}}</h1>
                    </a>
                    <p>{{ project['description'].get(lang, project['description'].get('de', '')) }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </section>
    </main>
    <footer>
        <p class="footer">{{ footer }}</p>
    </footer>
    <script>
        const images = [
            "{{url_for('static',filename='sun.svg')}}",
            "{{url_for('static',filename='moon.svg')}}"
        ];
        function preloadImages() {
            const promises = images.map(src => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.onerror = reject;
                    img.src = src;
                });
            });
            return Promise.all(promises);
        }
        preloadImages();
    </script>
    <script>
        (function(){
            try{
                // ensure language menu is hidden by default
                const ld = document.getElementById('langDropdown');
                const lt = document.getElementById('langToggle');
                if(ld) { ld.classList.remove('open'); }
                if(lt) { lt.setAttribute('aria-expanded','false'); }

                const filterBtns = Array.from(document.querySelectorAll('.filter-btn'));
                const projects = Array.from(document.querySelectorAll('.project'));
                const folderTriggers = Array.from(document.querySelectorAll('.folder-trigger'));

                function showFilter(filter){
                    filterBtns.forEach(b => b.classList.toggle('active', b.dataset.filter === filter));
                    projects.forEach(p => {
                        const cat = p.dataset.category || 'other';
                        p.style.display = (filter === 'all' || cat === filter) ? 'block' : 'none';
                    });
                }

                window.applyFilter = showFilter;
                filterBtns.forEach(b => b.addEventListener('click', () => showFilter(b.dataset.filter)));
                folderTriggers.forEach(a => a.addEventListener('click', (e) => { e.preventDefault(); showFilter(a.dataset.filter || 'other'); }));
                // initial
                showFilter('all');
            }catch(e){console.warn(e)}
        })();
    </script>
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const navMenu = document.getElementById('navMenu');
        const langToggle = document.getElementById('langToggle');
        const langMenu = document.getElementById('langMenu');
        const langDropdown = document.getElementById('langDropdown');
        const themeToggle = document.getElementById('themeToggle');
        const modetoggle = document.getElementById('modetoggle');

        menuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            navMenu.classList.toggle('active');
        });

        navMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });

        langToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const expanded = langToggle.getAttribute('aria-expanded') === 'true';
            langToggle.setAttribute('aria-expanded', String(!expanded));
            langDropdown.classList.toggle('open');
        });

        // anchors handle navigation; close menu after click
        langMenu.querySelectorAll('a').forEach(item => {
            item.addEventListener('click', (e) => {
                langDropdown.classList.remove('open');
                langToggle.setAttribute('aria-expanded', 'false');
            });
        });

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            modetoggle.src = theme === 'dark' ? '{{url_for("static", filename="moon.svg")}}' : '{{url_for("static", filename="sun.svg")}}';
            themeToggle.setAttribute('aria-pressed', String(theme === 'dark'));
        }

        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme') || 'light';
            setTheme(current === 'dark' ? 'light' : 'dark');
        });

        (function(){
            const stored = localStorage.getItem('theme');
            if (stored) {
                setTheme(stored);
            } else {
                // Default to dark mode on main page
                setTheme('dark');
            }
        })();

        document.addEventListener('click', (e) => {
            if (!e.target.closest('header')) {
                navMenu.classList.remove('active');
            }
            if (!e.target.closest('#langDropdown')) {
                langDropdown.classList.remove('open');
                langToggle.setAttribute('aria-expanded', 'false');
            }
        });
    </script>
    <script src="{{ url_for('static', filename='image-modal.js') }}"></script>
</body>
</html> 